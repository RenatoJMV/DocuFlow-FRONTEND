<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DocuFlow - Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="../../shared/styles/styles.css">
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>
  <!-- Test de conexión al backend -->
  <script src="../../shared/utils/connectionTest.js"></script>

  <!-- Navbar Container -->
  <div id="navbar-container" style="margin: 2rem;"></div>

  <div class="dashboard-container">
    <div class="dashboard-header card-modern mb-4">
      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-3">
          <div class="logo-container">
            <img src="https://cdn-icons-png.flaticon.com/512/3064/3064197.png" alt="DocuFlow Logo" class="dashboard-logo">
          </div>
          <div>
            <h2 class="mb-1 text-primary">Dashboard DocuFlow</h2>
            <p class="text-muted mb-0">Bienvenido de vuelta, gestiona tus documentos</p>
          </div>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-modern btn-outline-modern" onclick="refreshDashboard()">
            <i class="bi bi-arrow-clockwise"></i>
            Actualizar
          </button>
          <button class="btn btn-modern btn-primary-modern" onclick="showQuickActions()">
            <i class="bi bi-plus-lg"></i>
            Acción Rápida
          </button>
        </div>
      </div>
    </div>

    <div class="dashboard-widgets">
      <div class="widget-modern card-modern animate-slide-in" style="--delay: 0.1s">
        <div class="widget-header">
          <div class="widget-icon bg-gradient-primary">
            <i class="bi bi-cloud-arrow-up"></i>
          </div>
          <div class="widget-trend">
            <span class="trend-up" id="files-trend">+0%</span>
          </div>
        </div>
        <div class="widget-content">
          <h3 class="widget-value" id="widget-files">0</h3>
          <p class="widget-title">Archivos Subidos</p>
          <small class="text-muted">Total en el sistema</small>
        </div>
      </div>

      <div class="widget-modern card-modern animate-slide-in" style="--delay: 0.2s">
        <div class="widget-header">
          <div class="widget-icon bg-gradient-success">
            <i class="bi bi-people"></i>
          </div>
          <div class="widget-trend">
            <span class="trend-up" id="users-trend">+0%</span>
          </div>
        </div>
        <div class="widget-content">
          <h3 class="widget-value" id="widget-users">0</h3>
          <p class="widget-title">Usuarios Registrados</p>
          <small class="text-muted">Usuarios activos</small>
        </div>
      </div>

      <div class="widget-modern card-modern animate-slide-in" style="--delay: 0.3s">
        <div class="widget-header">
          <div class="widget-icon bg-gradient-warning">
            <i class="bi bi-chat-dots"></i>
          </div>
          <div class="widget-trend">
            <span class="trend-neutral" id="comments-trend">+0%</span>
          </div>
        </div>
        <div class="widget-content">
          <h3 class="widget-value" id="widget-comments">0</h3>
          <p class="widget-title">Comentarios</p>
          <small class="text-muted">Interacciones totales</small>
        </div>
      </div>

      <div class="widget-modern card-modern animate-slide-in" style="--delay: 0.4s">
        <div class="widget-header">
          <div class="widget-icon bg-gradient-info">
            <i class="bi bi-download"></i>
          </div>
          <div class="widget-trend">
            <span class="trend-up" id="downloads-trend">+0%</span>
          </div>
        </div>
        <div class="widget-content">
          <h3 class="widget-value" id="widget-downloads">0</h3>
          <p class="widget-title">Descargas Hoy</p>
          <small class="text-muted">Últimas 24 horas</small>
        </div>
      </div>
    </div>

    <!-- Fila con Sistema y Notificaciones -->
    <div class="row mt-4">
      <div class="col-lg-4">
        <div class="card-modern system-health-card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">
              <i class="bi bi-heart-pulse text-primary me-2"></i>
              Estado del Sistema
            </h6>
            <button class="btn btn-sm btn-outline-primary" onclick="showSystemHealth()">
              <i class="bi bi-fullscreen"></i> Ver Detalles
            </button>
          </div>
          <div class="card-body p-3">
            <div id="system-health-widget">
              <div class="text-center text-muted">
                <div class="spinner-border spinner-border-sm" role="status">
                  <span class="visually-hidden">Cargando...</span>
                </div>
                <p class="mb-0 mt-2">Verificando estado...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="card-modern notifications-card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">
              <i class="bi bi-bell text-info me-2"></i>
              Notificaciones Recientes
            </h6>
            <div class="d-flex gap-2">
              <span class="badge bg-primary" id="dashboard-notification-count">0</span>
              <button class="btn btn-sm btn-outline-info" onclick="showAllNotifications()">
                <i class="bi bi-list"></i> Ver Todas
              </button>
            </div>
          </div>
          <div class="card-body p-3">
            <div id="recent-notifications-widget">
              <div class="text-center text-muted">
                <div class="spinner-border spinner-border-sm" role="status">
                  <span class="visually-hidden">Cargando...</span>
                </div>
                <p class="mb-0 mt-2">Cargando notificaciones...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="card-modern quick-actions-card">
          <div class="card-header">
            <h6 class="mb-0">
              <i class="bi bi-lightning text-warning me-2"></i>
              Acciones Rápidas
            </h6>
          </div>
          <div class="card-body p-3">
            <div class="d-grid gap-2">
              <button class="btn btn-outline-primary btn-sm" onclick="refreshDashboard()">
                <i class="bi bi-arrow-clockwise me-2"></i>Actualizar Dashboard
              </button>
              <button class="btn btn-outline-info btn-sm" onclick="exportStats()">
                <i class="bi bi-download me-2"></i>Exportar Estadísticas
              </button>
              <button class="btn btn-outline-warning btn-sm" onclick="cleanupSystem()">
                <i class="bi bi-trash me-2"></i>Limpiar Sistema
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row mt-4">
      <div class="col-lg-8">
        <div class="dashboard-table card-modern">
          <div class="table-header d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>Actividad Reciente</h5>
            <div class="d-flex gap-2">
              <button class="btn btn-sm btn-outline-modern" onclick="exportActivity()">
                <i class="bi bi-download"></i>
                Exportar
              </button>
              <button class="btn btn-sm btn-outline-modern" onclick="filterActivity()">
                <i class="bi bi-funnel"></i>
                Filtrar
              </button>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th><i class="bi bi-file-earmark me-1"></i>Archivo</th>
                  <th><i class="bi bi-lightning me-1"></i>Acción</th>
                  <th><i class="bi bi-person me-1"></i>Usuario</th>
                  <th><i class="bi bi-calendar me-1"></i>Fecha</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody id="activity-table">
                <tr>
                  <td colspan="5" class="text-center text-muted py-4">
                    <div class="d-flex flex-column align-items-center">
                      <i class="bi bi-clock-history display-6 text-muted mb-2"></i>
                      <p class="mb-0">Sin actividad reciente</p>
                      <small class="text-muted">Los eventos aparecerán aquí cuando ocurran</small>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
      <div class="col-lg-4">
        <div class="dashboard-stats card-modern mb-3">
          <h6 class="mb-3"><i class="bi bi-graph-up me-2"></i>Estadísticas Rápidas</h6>
          <div class="stats-list">
            <div class="stat-item">
              <div class="stat-icon bg-primary">
                <i class="bi bi-file-text"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value" id="stat-documents">0</div>
                <div class="stat-label">Documentos</div>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon bg-success">
                <i class="bi bi-check-circle"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value" id="stat-processed">0</div>
                <div class="stat-label">Procesados</div>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon bg-warning">
                <i class="bi bi-clock"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value" id="stat-pending">0</div>
                <div class="stat-label">Pendientes</div>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon bg-danger">
                <i class="bi bi-exclamation-circle"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value" id="stat-errors">0</div>
                <div class="stat-label">Errores</div>
              </div>
            </div>
          </div>
        </div>

        <div class="quick-actions card-modern">
          <h6 class="mb-3"><i class="bi bi-lightning-fill me-2"></i>Acciones Rápidas</h6>
          <div class="d-grid gap-2">
            <button class="btn btn-modern btn-primary-modern btn-sm" onclick="window.location.href='../files/upload.html'">
              <i class="bi bi-cloud-upload"></i>
              Subir Archivo
            </button>
            <button class="btn btn-modern btn-success-modern btn-sm" onclick="window.location.href='../comments/comments.html'">
              <i class="bi bi-chat-square-text"></i>
              Ver Comentarios
            </button>
            <button class="btn btn-modern btn-outline-modern btn-sm" onclick="window.location.href='../permissions/permissions.html'">
              <i class="bi bi-shield-check"></i>
              Gestionar Permisos
            </button>
            <button class="btn btn-modern btn-outline-modern btn-sm" onclick="window.location.href='../logs/logs.html'">
              <i class="bi bi-list-ul"></i>
              Ver Logs
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="../../shared/utils/uiHelpers.js"></script>
  <script type="module" src="dashboardController.js"></script>
</body>
</html>
